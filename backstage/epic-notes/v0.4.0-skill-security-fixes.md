# v0.4.0 - Skill Security Fixes

**Epic created:** 2026-02-14  
**Source:** ClawHub OpenClaw Security Scan Report  
**Status:** Planning

---

## ClawHub Security Scan Report (2026-02-14)

**Verdict:** ⚠️ **Suspicious** (high confidence)

**VirusTotal:** Pending  
**OpenClaw Scan:** Failed (3 major issues)

---

## Security Issues Identified

### 1. Undeclared $HOME Access

**Problem:**
- `checks.sh` reads `$HOME/Documents/backstage/backstage/global/policies (global/local)`
- Hard-coded path outside project scope
- Not declared in skill metadata (no `paths` or `env` requirements)
- Disproportionate access to user's home directory

**Risk:**
- Skill accesses files user didn't explicitly authorize
- Could expose sensitive config/data
- Violates least-privilege principle

**Scan Quote:**
> "checks.sh reads global POLICY/HEALTH from a hard-coded path under $HOME — that access is not declared in the skill metadata and is outside the project scope the description implies."

---

### 2. Arbitrary Code Execution via eval

**Problem:**
- `checks.sh` extracts code blocks from `checks (global/local)`
- Executes them using `eval "$check"`
- No sandboxing, no interpreter restrictions
- Any bash command in checks (global/local) runs with full user permissions

**Risk:**
- Malicious code in checks (global/local) executes automatically
- User may not realize checks (global/local) = executable script
- High blast radius (full shell access)

**Scan Quote:**
> "checks.sh extracts code blocks from PROJECT/GLOBAL checks (global/local) and executes them using eval. Executing arbitrary code from README/HEALTH/POLICY files is powerful and can run any shell command; while this is part of the declared 'executable rules' model, it significantly increases risk and is not explicitly warned in metadata or SKILL.md as a dangerous capability."

---

### 3. File Modification + Git Operations (Undeclared)

**Problem:**
- Scripts modify repository files (navigation blocks, mermaid diagrams, checkboxes)
- Create/delete temp files in `/tmp`
- Git commits + pushes (with user prompt, but still powerful)
- Behavior not explicitly warned in metadata

**Risk:**
- Unexpected file changes
- Accidental commits
- Push to wrong remote

**Scan Quote:**
> "The runtime instructions/scripts modify repository files (inserting navigation blocks, replacing mermaid diagrams), create and remove temp files in /tmp, and perform git commits/pushes (backstage-end.sh prompts user to commit/push)."

---

## Scan Recommendations

> "Before installing or running it:
> 1. **Inspect checks (global/local)** and any global POLICY/HEALTH files for embedded bash code — those code blocks will be executed.
> 2. **Back up your repo**, and run the scripts in a sandbox or throwaway clone first.
> 3. If you don't want the skill to read files in your home directory, **do not run it** until checks.sh is adjusted to avoid or make the global path configurable.
> 4. Be aware the end script can commit and push changes (it prompts, but confirm remote safety).
> 5. **Prefer a version of the skill that:**
>    - Documents and declares required config paths
>    - Runs executable checks in a safer, sandboxed manner (e.g., avoid eval or run checks under restricted interpreter)
>    - Removes hard-coded globals
>    - Removes/limits eval-driven execution (or documents explicit warnings)
> 
> If the author can justify the HOME path, remove hard-coded globals, and remove/limit eval-driven execution (or document explicit warnings), my assessment would move toward benign."

---

## Tasks to Discuss

### Metadata & Documentation
- [ ] **Declare $HOME path access** in skill metadata (`paths` or `config` requirement)
- [ ] **Document eval execution** explicitly in SKILL.md warnings section
- [ ] **Add security warning** in README/SKILL.md: "checks (global/local) code blocks execute with full shell access"
- [ ] **Update skill description** to mention file modification + git operations

### Architecture Changes (Consider)
- [ ] **Make global path configurable** (env var or skill config, not hardcoded)
- [ ] **Sandbox eval execution** (restricted interpreter? Docker? VM?)
- [ ] **Alternative to eval** (parse checks differently? Pre-validate code blocks?)
- [ ] **Explicit permission model** (user approves checks (global/local) execution before first run?)

### Policy Questions
- [ ] **Is eval justified?** (executable rules = core feature, or over-engineered?)
- [ ] **Is $HOME access justified?** (global POLICY/HEALTH = universal rules, or scope creep?)
- [ ] **Should skill prompt before modifying files?** (auto-update vs explicit approval)
- [ ] **Git operations: always prompt, or auto-commit allowed?**

---

## Design Philosophy Discussion

**Current design:**
- checks (global/local) = executable tests (bash code blocks)
- policies (global/local) = interpretive rules (AI reads + acts)
- Polycentric governance (global + project, project wins)
- Auto-sync docs with reality (anti-drift)

**Security tradeoff:**
- Power = flexibility (execute anything in checks (global/local))
- Risk = trust (user must audit checks (global/local) before running)

**Question:** Is this the right tradeoff, or too dangerous for public skill?

---

## Potential Solutions (Brainstorm)

### Option A: Document + Warn (minimal change)
- Add explicit warnings in SKILL.md
- Declare $HOME path in metadata
- Keep eval (document risk clearly)
- **Pro:** Maintains flexibility
- **Con:** Still "suspicious" scan result

### Option B: Configurable Paths (medium change)
- Replace hardcoded `$HOME/Documents/backstage/...` with env var
- User sets `BACKSTAGE_GLOBAL_PATH` in .env
- **Pro:** User controls access
- **Con:** More setup friction

### Option C: Sandbox eval (major change)
- Run HEALTH checks in restricted bash (rbash? chroot? Docker?)
- Limit allowed commands (whitelist git, ls, grep, etc.)
- **Pro:** Safer execution
- **Con:** Complex implementation, may break valid checks

### Option D: No eval (radical change)
- Remove executable HEALTH checks entirely
- checks (global/local) = only AI-interpretable prose
- Use separate test scripts (explicit, not extracted from markdown)
- **Pro:** No arbitrary code execution
- **Con:** Loses "executable rules" paradigm

### Option E: Hybrid (best of both?)
- Keep eval for project-local checks (global/local) (user writes it, they own risk)
- **Remove** eval for global checks (global/local) (too much power for shared file)
- Make global path configurable
- Add explicit warnings
- **Pro:** Balances flexibility + safety
- **Con:** Asymmetric model (may confuse users)

---

## Next Steps

1. **Discuss philosophy** - Is eval core to backstage, or removable?
2. **Prioritize fixes** - Which issues block adoption vs nice-to-have?
3. **Decide on solution** - A/B/C/D/E or combination?
4. **Update skill** - Implement chosen approach
5. **Re-publish** - Get "benign" or "safe" scan result
6. **Document decision** - Why we chose this approach (for future reference)

---

**This epic = security hardening + design validation. Not just "fix bugs" — fundamental questions about skill safety model.**
