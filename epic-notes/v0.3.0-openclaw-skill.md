# Backstage Skill Flow

**Flow visual do backstage skill — combinado e implementado**

**How it works:** [See epic-notes/v0.3.0-openclaw-skill.md](https://github.com/nonlinear/backstage/blob/main/epic-notes/v0.3.0-openclaw-skill.md)

---

```mermaid
flowchart TD
    START([Trigger + project]) --> CHECK_BACKSTAGE{Has Backstage?}
    
    CHECK_BACKSTAGE -->|No| INSTALL([1️⃣ Install Backstage])
    
    CHECK_BACKSTAGE -->|Yes| VERSION_CHECK{Up to date?}
    
    VERSION_CHECK -->|Yes| READ_POLICY
    
    VERSION_CHECK -->|No| ASK_UPDATE{2️⃣ Update Backstage?}
    
    ASK_UPDATE -->|Yes| UPDATE([3️⃣ Update Backstage])
    ASK_UPDATE -->|No| READ_POLICY
    
    INSTALL --> READ_POLICY
    UPDATE --> READ_POLICY
    
    READ_POLICY([Read global + project POLICY<br/>- project wins global -]) --> EXECUTE_POLICY
    
    EXECUTE_POLICY([Execute POLICY protocol]) --> READ_HEALTH
    
    READ_HEALTH([Read global + project HEALTH<br/>- project wins global -]) --> RUN_HEALTH
    
    RUN_HEALTH([Run HEALTH protocol]) --> CHECKS_PASS{Pass?}
    
    CHECKS_PASS -->|No| TRY_FIX([Try auto-fix])
    
    TRY_FIX --> RECHECK{Fixed?}
    
    RECHECK -->|No| REPORT_USER([Report errors])
    RECHECK -->|Yes| DISPLAY
    
    CHECKS_PASS -->|Yes| DISPLAY
    
    REPORT_USER --> DISPLAY
    
    DISPLAY([POLICY displays next]) --> READ_POLICY
    
    style CHECK_BACKSTAGE fill:#e1f5ff
    style VERSION_CHECK fill:#e1f5ff
    style CHECKS_PASS fill:#e1f5ff
    style RECHECK fill:#e1f5ff
    style ASK_UPDATE fill:#e1f5ff
    
    style START fill:#e1f5ff
    style READ_POLICY fill:#e1f5ff
    style EXECUTE_POLICY fill:#e1f5ff
    style READ_HEALTH fill:#e1f5ff
    style RUN_HEALTH fill:#e1f5ff
    style TRY_FIX fill:#e1f5ff
    style REPORT_USER fill:#e1f5ff
    style DISPLAY fill:#e1f5ff
    
    style INSTALL fill:#e1f5ff
    style UPDATE fill:#e1f5ff
    
    click READ_POLICY "https://github.com/nonlinear/backstage/blob/main/global/POLICY.md" "global/POLICY.md"
    click READ_HEALTH "https://github.com/nonlinear/backstage/blob/main/global/HEALTH.md" "global/HEALTH.md"
```

---

**1️⃣ Install Backstage**
- **Source:** `https://github.com/nonlinear/backstage` branch `main`
- **Files:** Copy `templates/*-template.md` → `backstage/*.md` (remove -template)
- Copy `global/POLICY.md` + `global/HEALTH.md` → `backstage/global/`
- **Result:** Project has backstage protocol foundation

**2️⃣ Update Backstage?**
- Ask once/day (check `backstage/.last-update-check` timestamp)
- Bypass if asked today + user said no
- **Format:** y/n prompt with tease message

**3️⃣ Update Backstage**
- **Version detection:** Branch name (epic) or CHANGELOG (main)
- **Check:** Compare INDEX nav block version vs repo main
- **Tease message:** Storytelling with inline GitHub links
- **If yes:** Replace `backstage/global/` from main (always overwrite)
- **Network fail:** Warn "couldn't check for updates" + continue
- **After:** global/POLICY updates INDEX with new version (branch dance)
